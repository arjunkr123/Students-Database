<<<<<<< HEAD
<?php/** * The rights of the user is taken into account to set this page * This page needs no service to be generated */ function IS_profile(&$page,$container_id,$id,$save_IS_button, $remove_IS_button){	$page->add_javascript("/static/widgets/header_bar.js");	$page->onload("var header = new header_bar('page_header','small'); header.setTitle('/static/selection/IS/IS_16.png', 'Information Session Profile');");	require_once("component/data_model/Model.inc");	require_once("component/selection/SelectionJSON.inc");	$rights = array();	$config = null;	$rights["read"] = PNApplication::$instance->user_management->has_right("see_information_session_details",true);	$rights["manage"] = PNApplication::$instance->user_management->has_right("edit_information_session",true);	$rights["add_IS"] = PNApplication::$instance->user_management->has_right("manage_information_session",true);	$rights["remove_IS"] = PNApplication::$instance->user_management->has_right("manage_information_session",true);	$config = PNApplication::$instance->selection->getConfig();	$calendar_id = PNApplication::$instance->selection->getCalendarId();	$campaign_id = PNApplication::$instance->selection->getCampaignId();	$fct_name = "IS_profile_".$page->generateID();	$page->onload($fct_name."();");	//lock the row if id != -1	$db_lock = null;	if($id != -1){		require_once("component/data_model/DataBaseLock.inc");		require_once("component/data_model/Model.inc");		$model = DataModel::get();		$table = $model->getTable("Information_session"); // here check is done is the user can access this table		$locked_by = null;		$db_lock = DataBaseLock::lockRow($table->getSQLNameFor(PNApplication::$instance->selection->getCampaignId()), $id, $locked_by);		if ($db_lock == null) {			PNApplication::error("This row is already locked by ".$locked_by);			return;		} else 			DataBaseLock::generateScript($db_lock);	}	?>		<script type='text/javascript'>		function <?php echo $fct_name; ?>(){		var config = null;		<?php if($config <> null) echo "config = ".json_encode($config).";";?>		var calendar_id = null;		<?php if($calendar_id <> null) echo "calendar_id = ".json_encode($calendar_id).";";?>		var rights = {};		<?php if(count($rights)>0) echo "rights.read = ".json_encode($rights["read"]).";"; ?>		<?php if(count($rights)>0) echo "rights.manage = ".json_encode($rights["manage"]).";"; ?>		<?php if(count($rights)>0) echo "rights.add_IS = ".json_encode($rights["add_IS"]).";"; ?>		<?php if(count($rights)>0) echo "rights.remove_IS = ".json_encode($rights["remove_IS"]).";"; ?>		var container = document.getElementById(<?php echo json_encode($container_id); ?>);		var data = null;		var organization_contacts = null;		var all_duration = null;		<?php $all_configs = include("component/selection/config.inc");			echo "all_duration = ".json_encode($all_configs["default_duration_IS"][2]).";";		?>				/* This variable will get the contacts of all the contacts points from the selected partners */		var partners_contacts_points = null;		<?php		$IS_data = SelectionJSON::InformationSessionFromID($id);		echo "data = ".$IS_data.";";		echo "\n";		//Select all the partners IDs		$partners = array();		if($id != -1 && $id != "-1")			$partners = SQLQuery::create()				->select("Information_session_partner")				->field("organization")				->whereValue("Information_session_partner","information_session",$id)				->executeSingleField();		if($id != -1 && $id != "-1"){			if(count($partners) > 0){				require_once("component/contact/service/get_contacts.inc");				$first = true;				echo "organization_contacts = [";				foreach($partners as $partner_id){					if(!$first) echo ", ";					echo get_contacts("Organization_contact", "organization", "Organization_address", "organization",$partner_id,false,true);					$first = false;				}				echo "];";			} else echo "organization_contacts = [];";			//echo "organization_contacts = ".$organization_contacts.";";		} else echo "organization_contacts = [];";				require_once("component/contact/service/get_json_contact_points_no_address.inc");		echo "\n";		if($id != -1 && $id != "-1") echo "partners_contacts_points = ".get_json_contact_points_no_address($partners).";";		else echo "partners_contacts_points = [];";		?>		var required = 0;		var id = <?php echo json_encode($id).";"; ?>		var campaign_id = <?php echo json_encode($campaign_id);?>;		require("IS_profile.js",function(){			required = required +1;			everything_ready();		});		everything_ready = function(){			if(required == 1) init();		}				init = function(){			if(!rights.read)				error_dialog("You are not allowed to access the information sessions data");			else {				var save_IS_button = <?php echo json_encode($save_IS_button);?>;				var remove_IS_button = <?php echo json_encode($remove_IS_button);?>;				if(id == -1 || id == "-1"){					// This is a creation so check that the current user is allowed to add an IS					if(rights.add_IS) new IS_profile(id, config, calendar_id, rights, container, data, organization_contacts,partners_contacts_points,all_duration,campaign_id,save_IS_button,remove_IS_button,<?php echo json_encode($db_lock);?>);					else error_dialog("You are not allowed to create an Information Session");				} else new IS_profile(id, config, calendar_id, rights, container, data,organization_contacts,partners_contacts_points,all_duration,campaign_id,save_IS_button,remove_IS_button,<?php echo json_encode($db_lock);?>);			}		}			}	</script>	<?php}?>
=======
<?php/** * The rights of the user is taken into account to set this page * This page needs no service to be generated */ function IS_profile(&$page,$container_id,$id,$save_IS_button, $remove_IS_button){	$page->add_javascript("/static/widgets/header_bar.js");	$page->onload("var header = new header_bar('page_header','small'); header.setTitle('/static/selection/IS/IS_16.png', 'Information Session Profile');");	require_once("component/data_model/Model.inc");	require_once("component/selection/SelectionJSON.inc");	$rights = array();	$config = null;	$rights["read"] = PNApplication::$instance->user_management->has_right("see_information_session_details",true);	$rights["manage"] = PNApplication::$instance->user_management->has_right("edit_information_session",true);	$rights["add_IS"] = PNApplication::$instance->user_management->has_right("manage_information_session",true);	$rights["remove_IS"] = PNApplication::$instance->user_management->has_right("manage_information_session",true);	$config = PNApplication::$instance->selection->getConfig();	$calendar_id = PNApplication::$instance->selection->getCalendarId();	$campaign_id = PNApplication::$instance->selection->getCampaignId();	$fct_name = "IS_profile_".$page->generateID();	$page->onload($fct_name."();");		?>		<script type='text/javascript'>		function <?php echo $fct_name; ?>(){		var config = null;		<?php if($config <> null) echo "config = ".json_encode($config).";";?>		var calendar_id = null;		<?php if($calendar_id <> null) echo "calendar_id = ".json_encode($calendar_id).";";?>		var rights = {};		<?php if(count($rights)>0) echo "rights.read = ".json_encode($rights["read"]).";"; ?>		<?php if(count($rights)>0) echo "rights.manage = ".json_encode($rights["manage"]).";"; ?>		<?php if(count($rights)>0) echo "rights.add_IS = ".json_encode($rights["add_IS"]).";"; ?>		<?php if(count($rights)>0) echo "rights.remove_IS = ".json_encode($rights["remove_IS"]).";"; ?>		var container = document.getElementById(<?php echo json_encode($container_id); ?>);		var data = null;		var organization_contacts = null;		var all_duration = null;		<?php $all_configs = include("component/selection/config.inc");			echo "all_duration = ".json_encode($all_configs["default_duration_IS"][2]).";";		?>				/* This variable will get the contacts of all the contacts points from the selected partners */		var partners_contacts_points = null;		<?php		$IS_data = SelectionJSON::InformationSessionFromID($id);		echo "data = ".$IS_data.";";		echo "\n";		//Select all the partners IDs		$partners = array();		if($id != -1 && $id != "-1")			$partners = SQLQuery::create()				->select("InformationSessionPartner")				->field("organization")				->whereValue("InformationSessionPartner","information_session",$id)				->executeSingleField();		if($id != -1 && $id != "-1"){			if(count($partners) > 0){				require_once("component/contact/service/get_contacts.inc");				$first = true;				echo "organization_contacts = [";				foreach($partners as $partner_id){					if(!$first) echo ", ";					echo get_contacts("OrganizationContact", "organization", "OrganizationAddress", "organization",$partner_id,false,true);					$first = false;				}				echo "];";			} else echo "organization_contacts = [];";			//echo "organization_contacts = ".$organization_contacts.";";		} else echo "organization_contacts = [];";				require_once("component/contact/service/get_json_contact_points_no_address.inc");		echo "\n";		if($id != -1 && $id != "-1") echo "partners_contacts_points = ".get_json_contact_points_no_address($partners).";";		else echo "partners_contacts_points = [];";		?>		var required = 0;		var id = <?php echo json_encode($id).";"; ?>		var campaign_id = <?php echo json_encode($campaign_id);?>;		require("IS_profile.js",function(){			required = required +1;			everything_ready();		});		everything_ready = function(){			if(required == 1) init();		}				init = function(){			if(!rights.read)				error_dialog("You are not allowed to access the information sessions data");			else {				var save_IS_button = <?php echo json_encode($save_IS_button);?>;				var remove_IS_button = <?php echo json_encode($remove_IS_button);?>;				if(id == -1 || id == "-1"){					// This is a creation so check that the current user is allowed to add an IS					if(rights.add_IS) new IS_profile(id, config, calendar_id, rights, container, data, organization_contacts,partners_contacts_points,all_duration,campaign_id,save_IS_button,remove_IS_button);					else error_dialog("You are not allowed to create an Information Session");				} else new IS_profile(id, config, calendar_id, rights, container, data,organization_contacts,partners_contacts_points,all_duration,campaign_id,save_IS_button,remove_IS_button);			}		}			}	</script>	<?php}?>
>>>>>>> de70a504faf0802e543fe7b5ac9b4b7716556d25
