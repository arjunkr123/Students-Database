<?php/** * The rights of the user is taken into account to set this page * This page needs no service to be generated */ function IS_profile(&$page,$container_id,$id,$save_IS_button, $remove_IS_button){	$page->add_javascript("/static/widgets/page_header.js");	$page->onload("var header = new page_header('page_header',true); header.setTitle(\"<img src = '/static/selection/IS_16.png'/> Information Session Profile\");");	require_once("component/data_model/Model.inc");	$rights = array();	$config = null;	$rights["read"] = PNApplication::$instance->user_management->has_right("see_information_session_details",true);	$rights["manage"] = PNApplication::$instance->user_management->has_right("edit_information_session",true);	$rights["add_IS"] = PNApplication::$instance->user_management->has_right("manage_information_session",true);	$rights["remove_IS"] = PNApplication::$instance->user_management->has_right("manage_information_session",true);	$config = PNApplication::$instance->selection->get_config();	$calendar_id = PNApplication::$instance->selection->get_calendar_id();	$campaign_id = PNApplication::$instance->selection->get_campaign_id();	$fct_name = "IS_profile_".$page->generateID();	$page->onload($fct_name."();");		?>		<script type='text/javascript'>		function <?php echo $fct_name; ?>(){		var config = null;		<?php if($config <> null) echo "config = ".json_encode($config).";";?>		var calendar_id = null;		<?php if($calendar_id <> null) echo "calendar_id = ".json_encode($calendar_id).";";?>		var rights = {};		<?php if(count($rights)>0) echo "rights.read = ".json_encode($rights["read"]).";"; ?>		<?php if(count($rights)>0) echo "rights.manage = ".json_encode($rights["manage"]).";"; ?>		<?php if(count($rights)>0) echo "rights.add_IS = ".json_encode($rights["add_IS"]).";"; ?>		<?php if(count($rights)>0) echo "rights.remove_IS = ".json_encode($rights["remove_IS"]).";"; ?>		var container = document.getElementById(<?php echo json_encode($container_id); ?>);		var data = null;		var organization_contacts = null;		var all_duration = null;		<?php $all_configs = include("component/selection/config.inc");			echo "all_duration = ".json_encode($all_configs["default_duration_IS"][2]).";";		?>				/* This variable will get the contacts of all the contacts points from the selected partners */		var partners_contacts_points = null;		<?php		$IS_data = PNApplication::$instance->selection->get_json_IS_data($id,true);		echo "data = ".$IS_data["data"].";";		echo "\n";		if($id != -1 && $id != "-1"){			if(count($IS_data["partners"]) > 0){				require_once("component/contact/service/get_contacts.inc");				$first = true;				echo "organization_contacts = [";				foreach($IS_data["partners"] as $partner_id){					if(!$first) echo ", ";					echo get_contacts("Organization_contact", "organization", "Organization_address", "organization",$partner_id,false,true);					$first = false;				}				echo "];";			} else echo "organization_contacts = [];";			//echo "organization_contacts = ".$organization_contacts.";";		} else echo "organization_contacts = [];";				require_once("component/contact/service/get_json_contact_points_no_address.inc");		echo "\n";		if($id != -1 && $id != "-1") echo "partners_contacts_points = ".get_json_contact_points_no_address($IS_data["partners"]).";";		else echo "partners_contacts_points = [];";		?>		var required = 0;		var id = <?php echo json_encode($id).";"; ?>		var campaign_id = <?php echo json_encode($campaign_id);?>;		require("IS_profile.js",function(){			required = required +1;			everything_ready();		});		everything_ready = function(){			if(required == 1) init();		}				init = function(){			if(!rights.read)				error_dialog("You are not allowed to access the information sessions data");			else {				var save_IS_button = <?php echo json_encode($save_IS_button);?>;				var remove_IS_button = <?php echo json_encode($remove_IS_button);?>;				if(id == -1 || id == "-1"){					// This is a creation so check that the current user is allowed to add an IS					if(rights.add_IS) new IS_profile(id, config, calendar_id, rights, container, data, organization_contacts,partners_contacts_points,all_duration,campaign_id,save_IS_button,remove_IS_button);					else error_dialog("You are not allowed to create an Information Session");				} else new IS_profile(id, config, calendar_id, rights, container, data,organization_contacts,partners_contacts_points,all_duration,campaign_id,save_IS_button,remove_IS_button);			}		}			}	</script>	<?php}?>