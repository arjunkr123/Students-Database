<?php require_once("/../selection_page.inc");require_once("component/selection/SelectionJSON.inc");class page_eligibility_rules_manage_exam_topic extends selection_page {	public function get_required_rights() { return array(); }	public function execute_selection_page(&$page){		/* Check the rights */		if(!PNApplication::$instance->user_management->has_right("manage_exam_subject",true)){			?>			<script type = "text/javascript">			error_dialog("You are not allowed to manage the exam topics for eligibility rules");			</script>			<?php		} else {			//initialize all the rights to true because manage_exam_subject is true			$can_add = true;			$can_edit = true;			$can_remove = true;			$restricted = PNApplication::$instance->selection->updateRightsFromStepsDependenciesRestrictions("define_topic_for_eligibility_rules",$can_add,$can_remove,$can_edit);			if($restricted[0]){				?>				<script type = "text/javascript">				var error_text = <?php echo json_encode($restricted[1]);?>;				error_dialog(error_text);				</script>				<?php			}			if($can_edit){				$id = null;				if(isset($_GET["id"]))					$id = $_GET["id"];				else					$id = -1;				//temp				$id = -1;				$container_id = $page->generateID();				$topic = null;				$other_topics = null;				if($id ==  -1 || $id == "-1"){					//initialize topic object					$topic = "{id:-1,name:\"New Topic\",subjects:[]}";				} else {					require_once 'component/selection/SelectionJSON.inc';					$topic = SelectionJSON::ExamTopicForEligibilityRulesFromID($id);				}				$other_topics = SelectionJSON::getJsonAllTopics($id);				$json_all_parts = SelectionJSON::getJsonAllParts();								//temp// 				echo "topic: ".$topic;// 				echo "<br/><br/><br/>";// 				echo "all_parts: ".$json_all_parts;// 				echo "<br/><br/><br/>";// 				echo "other_topics: ".$other_topics;// 				echo "<br/><br/><br/>";								$page->add_javascript("/static/widgets/vertical_layout.js");				$page->onload("new vertical_layout('manage_topic_container');");				?>				<div id = "manage_topic_container" style = "width:100%; height:100%">					<div id = "page_header">						<div class = "button" onclick = "location.assign('/dynamic/selection/page/exam/main_page');"><img src = '<?php echo theme::$icons_16['back'];?>'/> Back</div>						<div class = "button" id = "save_topic_button"><img src = '<?php echo theme::$icons_16["save"];?>' /> <b>Save</b></div>						<div class = "button" id = "remove_topic_button"><img src = '<?php echo theme::$icons_16["remove"];?>' /> Remove Topic</div>					</div>					<div id='<?php echo $container_id; ?>' style = "overflow:auto" layout = "fill"></div>				</div>				<?php								//Lock the table to have the last version of the other topics				$db_lock = null;				require_once("component/data_model/DataBaseLock.inc");				require_once("component/data_model/Model.inc");				$model = DataModel::get();				$table = $model->getTable("ExamTopicForEligibilityRule"); // here check is done is the user can access this table				$locked_by = null;				$db_lock = DataBaseLock::lockTable($table->getSQLNameFor(PNApplication::$instance->selection->getCampaignId()), $locked_by);				if ($db_lock == null) {					PNApplication::error("This row is already locked by ".$locked_by);					return;				} else					DataBaseLock::generateScript($db_lock);																?>				<script type = "text/javascript">				require(["manage_exam_topic_for_eligibility_rules.js","page_header.js"],function(){					var can_add = <?php echo json_encode($can_add);?>;					var can_edit = <?php echo json_encode($can_edit);?>;					var can_remove = <?php echo json_encode($can_remove);?>;					var container_id = <?php echo json_encode($container_id);?>;					var topic = <?php echo $topic;?>;					var other_topics = <?php echo $other_topics;?>;					var all_parts = <?php echo $json_all_parts;?>;					var db_lock = <?php echo json_encode($db_lock);?>;					var save_button = "save_topic_button";					var remove_button = "remove_topic_button";					var header = new page_header('page_header',true);					header.setTitle("<img src = '/static/selection/eligibility_rules/rules_16.png'/> Manage exam topic");					new manage_exam_topic_for_eligibility_rules(topic, container_id, can_add, can_edit, can_remove, other_topics, all_parts, db_lock, save_button, remove_button, header);				});				</script>				<?php			}		}	}	}